<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" Learn MERN 文档 Modules FeedUser Modules × Search results Close Documentation generated by JSDoc 3.6.4 on 2020-04-10T16:45:52+08:00 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" Learn MERN 文档 Modules FeedUser 简介 该项目是由 SNSoft Sdn Bhd 推出的一项培训功课，主要培训培训生适应后端开发的环境。 MERN 是什么？ M ongoDB 跨平台文档式数据库 E xpressJS JS框架，后端路由器 R eactJS 前端JS框架 N odeJS JS 运行环境 使用说明 使用前： 组件需求 Redis 安装成功后运行，并确保运行端口是 6379 系统运行： 主文件夹为 client 及 server Client 运行（端口 3000） learn-mean&gt; cd client learn-mean\\client&gt; npm start Server 运行（端口 5000） learn-mean&gt; cd server learn-mean\\server&gt; node server.js 系统流程 从 News Feed 界面开始 参数参考 用户（User）参数 参数 种类 必填 内容 / 注解 _id String 自动生成 MongoDB ObjectID，用以验证用户权限 fname String 是 用户名字 lname String 是 用户姓氏 username String 是 用户登入名，用以登录 pwd String 是 用户密码，用以登录 createdAt Timestamp 自动生成 用户账号创建的时间与日期 updatedAt Timestamp 自动生成 用户账号最后更新时间与日期 贴文（Feeds）参数 参数 种类 必填 内容 / 注解 _id String 自动生成 N/A user Array 否 贴文作者OID与点赞者OID upvote Number 否 总赞数 downvote Number 否 总差评数 content String 是 贴文内容 createdAt Timestamp 自动生成 贴文创建时间与日期，可用于计算贴文的发布时间 updatedAt Timestamp 自动生成 贴文最后更新时间与日期，可用于计算贴文的发布时间 代码运作 用户 注册 // ./server/routes/users.js router.route(\"/add\").post(async (req, res) =&gt; { const user = new User({ fname: req.body.fname, lname: req.body.lname, username: req.body.username, pwd: req.body.password }); try { const savedUser = await user.save(); res.send({ user: savedUser._id }); } catch (err) { console.log(err); res.sendStatus(400); } }); 成功注册例子 { header: { auth-header: jwt-token }, status: 200 } // 用户发出请求 { \"fname\": \"Timothy\", \"lname\": \"Goh\", \"username\": \"tim\", \"pwd\": \"tim\", } // MongoDB 数据存档 { \"_id\":{\"$oid\":\"5e68e6404f907236b0cfdc1f\"}, \"fname\":\"Timothy\",\"lname\":\"Goh\", \"username\":\"tim\", \"pwd\":\"$2a$10$yCPFUMcPscB5jgxzy5r/kOmG3zqGOxOEiKJuYPm3Hp9HM7/QcUkU6\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1583932992922\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1583932992922\"}} } 用户密码与数据库之所以有分别是因为在前端应用了bcrypt来让密码复杂化，可参考./client/src/pages/Timothy/components/create-user.component.js。用户注册成功后将自动跳转之贴文界（News Feed）。 // ./client/src/pages/Timothy/components/create-user.component.js import bcrypt from \"bcryptjs\"; export default class CreateUser extends React.Component { ... onSubmit(e) { e.preventDefault(); const user = { fname: this.state.fname, lname: this.state.lname, username: this.state.username, password: bcrypt.hashSync(this.state.password, bcrypt.genSalt(10)) } ... } } 失败注册例子 注册不能成功只源于用户提供的质询不足，返还status: 400。 登录 // ./server/routes/users.js const jwt = require('jsonwebtoken'); const TOKEN_SECRET = Token应用码 router.route(\"/login\").post(async (req, res) =&gt; { await User.findOne({ username: req.body.username }).then(user =&gt; { if (!user) { res.status(204); } else { bycrypt.compare(req.body.password, user.pwd).then(match =&gt; (match ？ res.sendStatus(200) : res.sendStatus(204))); const token = jwt.sign({ _id: user._id }, TOKEN_SECRET); res.header(\"auth-header\", token); res.json({ success: true, message: \"Logged In\"}); } }); }); 当用户发出登录请求时，系统将从搜索数据库里相应的用户名。若用户名存在数据库里，系统将会应用bcrypt解析数据库里的用户密码并与用户输入的密码进行对比，密码一致将成功，否者失败。 登录成功例子 { header: { auth-header: jwt-token }, status: 200 } // 用户发出请求 { \"username\": \"tim\", \"pwd\": \"tim\" } // MongoDB 数据存档相应用户名 { \"_id\":{\"$oid\":\"5e68e6404f907236b0cfdc1f\"}, \"fname\":\"Timothy\",\"lname\":\"Goh\", \"username\":\"tim\", \"pwd\":\"$2a$10$yCPFUMcPscB5jgxzy5r/kOmG3zqGOxOEiKJuYPm3Hp9HM7/QcUkU6\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1583932992922\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1583932992922\"}} } 登录失败例子 登录失败只源于用户名不存在或密码错误，返还status: 204。 贴文 贴文说明 每创建或更新一个贴文，该步骤都会进行用户验证，验证成功才可更新状态。验证所应用的部件是 JSON Web Token (JWT)。验证步骤将会是从Headers中的auth-header中获得用户登录资料。若auth-header为空，系统将会提示通知用户更新失败并要求进行登录。 // ./server/routes/verifyToken.js const jwt = require(\"jsonwebtoken\"); module.exports = function (req, res, next) { const token = req.header(\"auth-header\"); const TOKEN_SECRET = Token应用码 if (!token) return res.status(401).send('Access Denied'); try { const verified = jwt.verify(token, TOKEN_SECRET); req.user = verified; next(); } catch(err) { res.status(400).send('Invalid token'); } } 创建贴文 // ./server/routes/feed.js const verify = require(\"./verifyToken\"); router.post(\"/add\", verify, async (req, res) =&gt; { const feed = new Feed({ user: req.user._id, content: req.body.content }); try { const savedFeed = await feed.save(); const savedFeedWithUserData = await Feed.findById(savedFeed._id).populate(\"user\"); res.send(savedFeedWithUserData); } catch (err) { res.sendStatus(400); } }); 发布贴文成功 { \"header\":{ \"auth-header\": jwt_token } } // 用户发出创建贴文请求 { \"content\": \"Stay 127.0.0.1, don't go 255.255.255.255\" } // MongoDB 数据库存档 { \"_id\":{\"$oid\":\"5e8c2d690630f203e8dd47b4\"}, \"upvote\":{\"$numberInt\":\"0\"}, \"downvote\":{\"$numberInt\":\"0\"}, \"user\":{\"$oid\":\"5e68e6404f907236b0cfdc1f\"}, \"content\":\"Stay 127.0.0.1, don't go 255.255.255.255\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1586244969523\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1586244969523\"}} } 贴文发布失败 贴文发布失败的理由如： 用户未登录 贴文内容为空 点赞/给差评 // ./server/routes/feed.js const verify = require(\"./verifyToken\"); router.put(\"/updatee\", verify, async (req, res) =&gt; { try{ await Feed.findByIdAndUpdate(req.body._id, { upvote: req.body.upvote, downvote: req.body.downvote }); res.send({\"success\": true}); } catch { req.sendStatus(400); } }); 用户回应成功 { \"header\": { \"auth-header\": jwt_token } } { \"_id\":{\"$oid\":\"5e6b40c984ee6f5f87b42a04\"}, \"user\":[{\"$oid\":\"5e69ddb836ddf517d8f1e120\"}], \"upvote\":{\"$numberInt\":\"0\"}, \"downvote\":{\"$numberInt\":\"1\"}, \"content\":\"testing the latest release\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1584087241899\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1584087301497\"}} } 用户回应失败 用户给与回应失败的理由如： 用户未登录 用户在自己的贴问下给回应 × Search results Close Documentation generated by JSDoc 3.6.4 on 2020-04-10T16:45:52+08:00 using the DocStrap template. "},"module-Feed.html":{"id":"module-Feed.html","title":"Module: Feed","body":" Learn MERN 文档 Modules FeedUser Module: Feed Feed routes Methods &lt;inner&gt; createFeed(user, content) Parameters: Name Type Description user string Object ID of user who created the feed content string Content of the feed Returns: Success status: 200, data: [ { \"_id\":{\"$oid\":\"5e8c2d690630f203e8dd47b4\"}, \"upvote\":{\"$numberInt\":\"0\"}, \"downvote\":{\"$numberInt\":\"0\"}, \"user\":{\"$oid\":\"5e68e6404f907236b0cfdc1f\"}, \"content\":\"Stay 127.0.0.1, don't go 255.255.255.255\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1586244969523\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1586244969523\"}} }] Type Object Fail status: 400, data: 'Please login to create post' Type Object &lt;inner&gt; getFeedList() Returns: Success status: 200, data: [ { \"_id\":{\"$oid\":\"5e6b40c984ee6f5f87b42a04\"}, \"user\":[{\"$oid\":\"5e69ddb836ddf517d8f1e120\"}], \"upvote\":{\"$numberInt\":\"0\"}, \"downvote\":{\"$numberInt\":\"0\"}, \"content\":\"testing the latest release\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1584087241899\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1584087301497\"}} }, { \"_id\":{\"$oid\":\"5e8c2d690630f203e8dd47b4\"}, \"upvote\":{\"$numberInt\":\"0\"}, \"downvote\":{\"$numberInt\":\"0\"}, \"user\":{\"$oid\":\"5e68e6404f907236b0cfdc1f\"}, \"content\":\"adfadfadfasf\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1586244969523\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1586244969523\"}} }] Type Object.Array.&lt;Object&gt; Fail status: 400, data: 'Fail to fetch feed data' Type Object &lt;inner&gt; updateFeed(upvote, downvote) Parameters: Name Type Description upvote Boolean User like the feed post downvote Boolean User dislike the feed post Returns: Success status: 200, data: [ { \"_id\":{\"$oid\":\"5e6b40c984ee6f5f87b42a04\"}, \"user\":[{\"$oid\":\"5e69ddb836ddf517d8f1e120\"}], \"upvote\":{\"$numberInt\":\"0\"}, \"downvote\":{\"$numberInt\":\"0\"}, \"content\":\"testing the latest release\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1584087241899\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1584087301497\"}} }] Type Object Fail status: 400, data: 'Please login to upvote/downvote post' Type Object × Search results Close Documentation generated by JSDoc 3.6.4 on 2020-04-10T16:45:52+08:00 using the DocStrap template. "},"module-User.html":{"id":"module-User.html","title":"Module: User","body":" Learn MERN 文档 Modules FeedUser Module: User Methods &lt;inner&gt; createUser(fname, lname, username, password) Function to register user in order user can login to create a post feed Parameters: Name Type Description fname string User's first name lname string User's last name username string User's login username password string User's login password Returns: Success header: { auth-header: \"json web token\" }, status: 200, data: [ { \"_id\":{\"$oid\":\"5e68e6404f907236b0cfdc1f\"}, \"fname\":\"Timothy\",\"lname\":\"Goh\", \"username\":\"tim\", \"pwd\":\"$2a$10$yCPFUMcPscB5jgxzy5r/kOmG3zqGOxOEiKJuYPm3Hp9HM7/QcUkU6\", \"createdAt\":{\"$date\":{\"$numberLong\":\"1583932992922\"}}, \"updatedAt\":{\"$date\":{\"$numberLong\":\"1583932992922\"}} }] Type Object &lt;inner&gt; login(username, password) to authenticate the user and provide the right for user to create a post Parameters: Name Type Description username string User's login username, must be the same as registered password string User's login password, must be the same as registered Returns: Success header: { auth-header: \"json web token\" }, status: 200, data: \"login success\" Type Object Fail status: 400, data: 'Fail to login' Type Object × Search results Close Documentation generated by JSDoc 3.6.4 on 2020-04-10T16:45:52+08:00 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
